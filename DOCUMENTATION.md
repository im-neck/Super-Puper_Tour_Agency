# Документация по интерфейсам и алгоритмам

Ниже краткое (среднее по объему) описание ключевых частей проекта.

## 220. Архитектура

Система построена по слоистой архитектуре:
- API слой (FastAPI роуты): `app/api/v1/*`
- Сервисный слой (бизнес‑логика): `app/services/*`
- Модели и БД: `app/models/*`, SQL‑скрипты в `docs/db/`
- Безопасность: `app/security/*`
- Конфигурация: `app/settings.py`, `.env`

Основные сущности:
- Users (пользователи): роли Client/Manager/Admin
- Tours (туры)
- Bookings (бронирования)
- Справочники Countries/Resorts для нормализации направлений

Связи:
- Users (1) → (N) Bookings
- Tours (1) → (N) Bookings
- Countries (1) → (N) Resorts
- Countries (1) → (N) Tours
- Resorts (1) → (N) Tours

SQL‑скрипты для Greenplum/PostgreSQL находятся в `docs/db/`:
- таблицы/индексы: `001_create_tables.sql`
- представления: `002_views.sql`
- функции: `003_procedures.sql`

Для неточного поиска по названиям используется `pg_trgm` и GIN‑индексы на `countries.name`, `resorts.name`, `resorts.city`.

## 230. Сервисы (Backend API)

Аутентификация:
- `POST /api/auth/register` — регистрация пользователя
- `POST /api/auth/login` — логин по email (через поле `username` в OAuth2 form), выдача JWT

Туры:
- `GET /api/tours` — поиск/фильтрация туров (страна/город/даты/цена/питание/звезды)
- `GET /api/tours/{id}` — детали тура
- `POST /api/tours` — создание тура (только Admin)

Бронирования:
- `POST /api/bookings` — создать заявку
- `GET /api/bookings/my` — заявки текущего пользователя
- `PUT /api/bookings/{id}/cancel` — отмена заявки клиентом до подтверждения

Менеджер:
- `GET /api/manager/bookings` — список всех заявок
- `PUT /api/manager/bookings/{id}/status` — изменить статус/цену/комментарий

Бизнес‑логика:
- Авто‑отмена заявок, если не подтверждены за заданное время.
- Проверка доступности тура перед созданием бронирования.
- Ролевой доступ: менеджерские операции — только Manager/Admin.

## 240. UI (Пользовательский интерфейс)

- Главная/Поиск туров — форма поиска и быстрые фильтры.
- Каталог туров — список результатов с фильтрами/сортировкой.
- Карточка тура — подробности, условия, кнопка «Забронировать».
- Личный кабинет клиента — активные/прошлые бронирования со статусами.
- Панель менеджера — таблица заявок, действия Confirm/Cancel, комментарии.

Прототип интерфейса: `ui_prototype_figma/` 
